{% if app.session.get('user') is null %}
                <div class="intro-heading"><font size="8" color="black">Debe iniciar sesión</font></div>                        
{% else %}
<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title></title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!-- Latest compiled and minified CSS -->
	<!-- jQuery -->

  <script src="{{ asset('http://www.bardo1.com/web1/cotiDocs/assets/js/jquery-1.12.0.js') }}" type="text/javascript"></script>
   <script src="http://www.bardo1.com/web1/cotiDocs/assets/js/jquery-1.12.0.min.js"></script>
	<script src="http://www.bardo1.com/web1/cotiDocs/assets/js/index1.default.load.js"> </script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
	<link rel="stylesheet" href="http://www.bardo1.com/web1/cotiDocs/vendor/css/sweetalert.css">
	<link rel="stylesheet" href="http://www.bardo1.com/web1/cotiDocs/vendor/css/uikit.min.css">
	<!-- <link rel="stylesheet" href="vendor/css/dataTables.uikit.min.css"> -->
	<link rel="stylesheet" href="http://www.bardo1.com/web1/cotiDocs/assets/css/index.default.css">

	<script src="https://code.jquery.com/jquery-2.2.4.js"   integrity="sha256-iT6Q9iMJYuQiMWNd9lDyBUStIq/8PuOW33aOqmvFpqI="   crossorigin="anonymous"></script>
<script>window.jQuery || document.write('<script src="http://www.bardo1.com/web1/cotiDocs/vendor/js/jquery-2.2.4.js"><\/script>')</script>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
<!-- <script src="vendor/js/jquery.dataTables.min.js"></script> -->
<!-- <script src="vendor/js/dataTables.uikit.min.js"></script> -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
<!-- <script src="vendor/js/jquery.dataTables.min.js"></script> -->
<!-- <script src="vendor/js/dataTables.uikit.min.js"></script> -->
<script src="http://www.bardo1.com/web1/cotiDocs/vendor/js/sweetalert.min.js"></script>
   
<!-- <script src="index.default.load.js"> </script> -->
	<style>
	</style>
</head>
<body>
	<div class="container-fluid">
	<img src="C:\xampp\htdocs\AridosCelis\web\imagenes/logo.png" style="text-align: center;" width="450" height="150" /> </a>
<br>
 <div>
<div>
CRISTIAN ANDRES CELIS SANDOVAL
<br>
Transporte y Venta de Materiales de Construcción
<hr>
<br>
Señores :    {{ datosCoti.senior1 }}
<br>
<br>
Sr./a :    {{ datosCoti.senior2 }}
<br>
<br>
<div align="center">A continuación el detalle del producto solicitado</div>
<h1 class="text-center text-uppercase text-primary small"> Registro de Productos</h1> 






<form id="form-registro-estudiante">
      <table id="prueba" class="" class="table table-bordered table-condensed table-hover" hidden>
          <thead>
             <tr>        
               <th>Cantidad</th>
               <th>Detalle</th>
               <th>Valor Unitario</th>
               <th>Valor Total</th>
            </tr>
          </thead>
          <tbody hidden>
          <tr>     
           <td>
             <div class="form-group-sm col-lg-10" >
              <input name="cantidad" type="text" class="form-control" id="cantidad" placeholder="ingrese cantidad" />
             </div>
             <div id="mensage-3" class="text-danger hide" role="alert">
		      <small>Este campo no puede estar en blanco</small>
		     </div>
           </td>
          <td>
         <div class="form-group-sm col-lg-10">
            <input name="detalle" type="text" class="form-control" id="detalle" placeholder="ingrese detalle" />
          </div>
          <div id="mensage-4" class="text-danger hide" role="alert">
			<small>Este campo no puede estar en blanco</small>
		  </div>
      </td>
      <td>
          <div class="form-group-sm col-lg-10">
            <input name="valorunitario" type="number" class="form-control" id="valorunitario" placeholder="Ingrese valor unitario" />
          </div>
          <div id="mensage-5" class="text-danger hide" role="alert">
				<small>Este campo no puede estar en blanco</small>
		  </div>
      </td>
      <td>
          <div class="form-group-sm col-lg-10">
            <input name="valortotal" type="number" class="form-control" id="valortotal" placeholder="ingrese valor total" />
          </div>
          <div id="mensage-6" class="text-danger hide" role="alert">
				<small>Este campo no puede estar en blanco</small>
		  </div>
      </td>
    </tr> 
    </tbody>
		<div class="container-fluid" >
			<div class="row">
				<div class="col-lg-6">
					<form id="form-registro-estudiante">
					  <table class="table table-bordered table-striped table-hover uk-table uk-table-hover uk-table-striped">		
					  </table>
				    </form><!-- FIN REGISTRO DE ESTUADIANTE -->
				</div>
			</div>
			<div class="col-lg-6" hidden>
				<table id="data-table-lista-estudiantes" class="table table-bordered table-striped table-hover uk-table uk-table-hover uk-table-striped" align="right" hidden>
					<caption> Acciones de botones </caption>
					<thead>
						<tr>
							<th>
								<small> Registrar Producto </small>
							</th>
							<th>
								<button id="btn-registrar-estudiante" class="btn  btn-success btn-xs small">
									<span class="glyphicon glyphicon-floppy-save" aria-hidden="true"></span> Guardar
								</button>
							</th>
						</tr>
						<tr>
							<th>
								<small> Mostrar Total a pagar </small>
							</th>
							<th>
								<button id="btn-mostrar-total-pago" class="btn  btn-warning btn-xs small" onload>
									<span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span> Ver
								</button>
							</th>
						</tr>
						<tr>
							<th>
								<small> Remover lista de productos </small>
							</th>
							<th>
								<button id="btn-remover-lista" class="btn  btn-danger btn-xs small" >
									<span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span> Ver
								</button>
							</th>
						</tr>
					</thead>
				</table> <!-- FIN LISTADO DE ESTUDIANTES -->
			</div>

			</div>
			<div class="col-lg-12">

			<table id="data-table-lista-estudiantes" class="table table-bordered table-striped table-responsive table-hover uk-table uk-table-hover uk-table-striped">
					<caption> Listado de Productos </caption>
					<thead>
						<tr id="insertar-th"><th class="text-muted small">Cantidad</th>
			<th class="text-muted small"> Detalle </th>
			<th class="text-muted small"> Valor unitario </th>
			<th class="text-muted small"> Valor total </th></tr>
					</thead>
					<tbody id="insertar-datos-estudiantes">
                    {% for arrayfinaldetalle in datosCoti.arrayfinaldetalle %}
					<tr>
					<td> {{ arrayfinaldetalle.cantidad }} </td>
					<td> {{ arrayfinaldetalle.detalle }} </td>
					<td> {{ arrayfinaldetalle.valorunitario }} </td>
					<td> {{ arrayfinaldetalle.valortotal }}</td>
					</tr>
                    {% endfor %}
					</tbody>
				</table>
			
			</div>

		</div>
<br>
<br>
<br>
<div class="row">
 <div class="col-xs-6" >
 <div style="width:500px; height:150px;">
<ul>
<li>Los valores cotizados son más IVA.</li>
<li>Plazo de entrega a la brevedad posible.</li>
<li>Pago a 60 dias desde la factuzación.</li>
</ul>
<br>
<p>Esperando una buena acogida, Saluda Atentamente a UD.</p>
<br>
<p>CRISTIAN CELIS SANDOVAL. </p>
  </div>
  </div>
   <div class="col-xs-6" >
       <div style="width:500px; height:150px;" align="center">
         <div class="col-lg-12" >
			<table id="data-table-lista-estudiantes" class="table table-bordered table-striped table-responsive table-hover uk-table uk-table-hover uk-table-striped">
			<caption> Valores </caption>
			<thead>
			<tr id="insertar-th1"><th class="text-center text-muted small">Total</th>
			<th class="text-center text-muted small">Iva </th>
			<th class="text-center text-muted small">Total + iva</th></tr>
			</thead>
			<tbody id="insertar-datos-productoconteo"><tr><td class="text-center text-muted small">{{ datosCoti.total }}</td>
		    <td class="text-center text-muted small">{{ datosCoti.iva }}</td>
			<td class="text-center text-muted small">{{ datosCoti.totaliva }}</td>
			</tr>
			</tbody>
			</table>
         </div>
       </div>
    </div>
   </div>
<br>
<br>
<br>
<div>
<div>
<hr>
Av. Americo Vespucio Norte Parcela 51, Maipú, Santiago/ Fono: (569): 9030 8359
<br>
caceliss@hotmail.com
<br>
     <!-- jQuery -->




</body>
<script type="text/javascript">
	
;
(function($, window, document, undefined) {

	'use strict';

	var CONFIGURACION_POR_DEFECTO = CONFIGURACION_POR_DEFECTO || {},
		localStorageEstudiante = {
			'datosEstudiante': [],
			'state': true
		};

	var self;

	CONFIGURACION_POR_DEFECTO = function() {

		self = this;
		self.init();
	};

	CONFIGURACION_POR_DEFECTO.prototype = {

		init: function() {
			this.eventosClick();
			this.cargaListaDeEstudiantes();
			this.mostrarTotalAPagar();
		},

		eventosClick: function(parametros) { // eventos de click general

			document.getElementById('btn-registrar-estudiante').addEventListener('click', self.registrarEstudiante); // evento click que registra estudiantes
		 	document.getElementById('btn-mostrar-total-pago').addEventListener('click', self.mostrarTotalAPagar); // evento click para mostrar promedios de estudiantes
	        document.getElementById('btn-remover-lista').addEventListener('click', self.removerLista); // evento click para mostrar promedios de estudiantes
		},

		
		registrarEstudiante: function(e) {
			e.stopPropagation();
			var formRegistroEstudiante = $('form#form-registro-estudiante').serializeArray(),
				extraerAlumno = {},
				extraerNotas = {};
			$.each(formRegistroEstudiante, function(key, field) {

				if (field.name === 'cantidad') {
					extraerAlumno['cantidad'] = field.value;
				}
				if (field.name === 'detalle') {
					extraerAlumno['detalle'] = field.value;
				}
				if (field.name === 'valorunitario') {
					extraerAlumno['valorUnitario'] = parseFloat(field.value);
				}
				if (field.name === 'valortotal') {
					extraerAlumno['valorTotal'] = parseFloat(field.value);
				}
			});

			if (self.validaCamposVacios(extraerAlumno)) { // función validaCamposVacios retorna true|false

					var JsonParseParametrosDatos = JSON.parse(localStorage.getItem('data.estudiante.session'));

					if (JsonParseParametrosDatos === null) {

						localStorageEstudiante.datosEstudiante.push({
							'cantidad': extraerAlumno.cantidad,
							'detalle': extraerAlumno.detalle,
							'valorUnitario': extraerAlumno.valorUnitario,
							'valorTotal': extraerAlumno.valorTotal
						});
                        
                        console.log(localStorageEstudiante);
						localStorage.setItem('data.estudiante.session', JSON.stringify(localStorageEstudiante));

						self.cargaMensajesAlert({
							tipo: 'success',
							titulo: 'Agregar',
							texto: 'Se agrego un nuevo registro',
							btnColor: '#b0e195',
						});
					} else {

						JsonParseParametrosDatos.datosEstudiante.push({
							'cantidad': extraerAlumno.cantidad,
							'detalle': extraerAlumno.detalle,
							'valorUnitario': extraerAlumno.valorUnitario,
							'valorTotal': extraerAlumno.valorTotal
						});

						localStorage.setItem('data.estudiante.session', JSON.stringify(JsonParseParametrosDatos));
                                                                   
						self.cargaMensajesAlert({
							tipo: 'success',
							titulo: 'Agregar',
							texto: 'Se agrego un nuevo registro',
							btnColor: '#b0e195',
						});
                         
                         $('#valortotal').val("");
						 $('#cantidad').val("");
                         $('#detalle').val("");
                         $('#valorunitario').val("");

					}
				
				
			}
		},

		mostrarTotalAPagar: function(e) {
        
			var JsonParseParametrosDatos = JSON.parse(localStorage.getItem('data.estudiante.session')),
				insertarHtmlEstudiante = '',
				insertarTh = '';

			insertarTh += 
		   `<th class="text-center text-muted small">Total</th>
			<th class="text-center text-muted small">Iva </th>
			<th class="text-center text-muted small">Total + iva</th>`;
            var suma=0;
			if (JsonParseParametrosDatos !== null) {

				$.each(JsonParseParametrosDatos.datosEstudiante, function(key, field) {
                    suma=suma+ field.valorTotal;
					console.log(suma);		
				});
                
                var total=suma;
                var iva=(suma*0.19);
                var totaliva=total+iva;

				insertarHtmlEstudiante += 
     		   `<td  class="text-center text-muted small">`+total+`</td>
				<td  class="text-center text-muted small">`+iva+`</td>
				<td  class="text-center text-muted small">`+totaliva+`</td>
				`;
			} else {
				insertarHtmlEstudiante +=
				`<tr>
				 <td colspan="8" class="text-center text-muted small"> No se encontrarón resultados </td>
				 </tr>`;
			}
            
            //guardar valores referenciales
            $('.seniores11').text($('#seniores1').val());
            $('.seniores22').text($('#seniores2').val());
            $('.seniores11').val($('#seniores1').val());
            $('.seniores22').val($('#seniores2').val());

			document.getElementById('insertar-th1').innerHTML = insertarTh;
			document.getElementById('insertar-datos-productoconteo').innerHTML = insertarHtmlEstudiante;

		},


		mostrarNotasPromedio: function(e) {

			e.preventDefault();

			var JsonParseParametrosDatos = JSON.parse(localStorage.getItem('data.estudiante.session'));

			var insertarHtmlPromediosEstudiantes = `<table class="table table-bordered table-responsive table-striped table-hover uk-table uk-table-hover uk-table-striped">
				<thead><tr> 
				<th class="text-muted small">Codigo</th> 
				<th class="text-muted small"> Nombre estudiante </th> 
				<th class="text-muted small">Promedio</th> </tr> <thead/> <tbody>`;

			if (JsonParseParametrosDatos !== null) {

				for (var i = 0; i < Object.keys(JsonParseParametrosDatos.datosEstudiante).length; i++) {

					insertarHtmlPromediosEstudiantes += `<tr> 
					<td>${ JsonParseParametrosDatos.datosEstudiante[i].codigo }</td>
					<td>${ JsonParseParametrosDatos.datosEstudiante[i].nombre }</td> 
					<td>${ self.calcularPromedio(JsonParseParametrosDatos.datosEstudiante[i].notas).toPrecision(3) }</td>
					</tr>`;
				}
			} else {

				insertarHtmlPromediosEstudiantes += `<tr>
				<td colspan="3" class="text-center text-muted small"> No se encontrarón resultados </td></tr>`;
			}

			insertarHtmlPromediosEstudiantes += `</tbody></table>`;

			swal({
				title: '<small>Listado de promedios</small> <hr>',
				text: insertarHtmlPromediosEstudiantes,
				confirmButtonColor: '#333',
				confirmButtonText: 'Aceptar',
				closeOnConfirm: true,
				html: true
			}, function() {});

		},

		mostrarNotaMayor: function(e) {
			e.preventDefault();
			self.simplificarMostrarNotaMenorYMayor('max');
		},
		mostrarNotaMenor: function(e) {
			e.preventDefault();
			self.simplificarMostrarNotaMenorYMayor('min');
		},
		removerLista: function(e) {
	    localStorage.removeItem('data.estudiante.session');
		},
		validaCamposVacios: function(parametros) { // valida que campos no estén vacios

			var resultado = true;
			// Cantidad - Detalle- valor unitario - valor total
			if (parametros.cantidad === '') {

				$('#mensage-3').removeClass('hide')
					.hide()
					.fadeIn(100)
					.fadeOut(3500);

				resultado = false;
			} else {

				$('#mensage-3').addClass('hide');
			}

			if (parametros.detalle === '') {

				$('#mensage-4').removeClass('hide')
					.hide()
					.fadeIn(100)
					.fadeOut(3500);

				resultado = false;
			} else {

				$('#mensage-4').addClass('hide');
			}

			if (parametros.valorUnitario === '') {

				$('#mensage-5').removeClass('hide')
					.hide()
					.fadeIn(100)
					.fadeOut(3500);

				resultado = false;
			} else {

				$('#mensage-5').addClass('hide');
			}

			if (parametros.valorTotal === '') {

				$('#mensage-6').removeClass('hide')
					.hide()
					.fadeIn(100)
					.fadeOut(3500);

				resultado = false;
			} else {

				$('#mensage-6').addClass('hide');
			}

			$.each(parametros.notas, function(key, data) {

				if (data === '') {

					$('#mensage-nota-' + key).removeClass('hide')
						.hide()
						.fadeIn(100)
						.fadeOut(3500);

					resultado = false;
				} else {

					$('#mensage-nota-' + key).addClass('hide');
				}
			});

			return resultado;
		},
		cargaListaDeEstudiantes: function() { // genera listado de estudiantes

			var JsonParseParametrosDatos = JSON.parse(localStorage.getItem('data.estudiante.session')),
				insertarHtmlEstudiante = '',
				insertarTh = '';

			insertarTh += `<th class="text-muted small">Cantidad</th>
			<th class="text-muted small"> Detalle </th>
			<th class="text-muted small"> Valor unitario </th>
			<th class="text-muted small"> Valor total </th>`;
            var suma=0;
			if (JsonParseParametrosDatos !== null) {

				$.each(JsonParseParametrosDatos.datosEstudiante, function(key, field) {

				insertarHtmlEstudiante += `<tr>
					<td> ${ field.cantidad } </td>
					<td> ${ field.detalle } </td>
					<td> ${ field.valorUnitario } </td>
					<td> ${ field.valorTotal } </td>`;

                    suma=suma+ field.valorTotal;
					console.log(suma);
                    console.log(parseFloat(field.valorUnitario).toPrecision(3));
				});

				insertarHtmlEstudiante += `</tr>`;
			} else {

				insertarHtmlEstudiante += `<tr>
				<td colspan="8" class="text-center text-muted small"> No se encontrarón resultados </td></tr>`;
			}

			document.getElementById('insertar-th').innerHTML = insertarTh;
			document.getElementById('insertar-datos-estudiantes').innerHTML = insertarHtmlEstudiante;
            
		},
		cargaMensajesAlert: function(parametros) { // genera mensajes de alerta


			swal({
				title: parametros.titulo,
				text: parametros.texto,
				type: parametros.tipo,
				confirmButtonColor: parametros.btnColor,
				confirmButtonText: 'Aceptar',
				closeOnConfirm: true
			}, function() {

				document.addEventListener('click', self.cargaListaDeEstudiantes);
			});
		},
		calcularPromedio: function(obj) { // calcular promedios de los estudiantes

			var suma = 0;

			for (var el in obj) {

				if (obj.hasOwnProperty(el)) {

					suma += parseFloat(obj[el] / Object.keys(obj).length);
				}
			}
			return suma;
		},
		simplificarMostrarNotaMenorYMayor: function(parametro) { // Simplifica código

			var JsonParseParametrosDatos = JSON.parse(localStorage.getItem('data.estudiante.session'));
			var insertarHtmlPromediosEstudiantesMin = `
			<table class="table table-bordered  table-responsive table-striped table-hover uk-table uk-table-hover uk-table-striped">
				<thead><tr> <th class="text-muted small">Codigo</th> <th class="text-muted small"> Nombre estudiante </th> <th class="text-muted small">Promedio</th> </tr> <thead/> <tbody>`;

			var newObject = {};
			if (JsonParseParametrosDatos !== null) {

				for (var key in JsonParseParametrosDatos) {

					for (var subKey in JsonParseParametrosDatos[key]) {

						newObject[subKey] = self.calcularPromedio(JsonParseParametrosDatos[key][subKey]['notas']).toPrecision(3);
					}
				}

				var arr = Object.keys(newObject).map(function(key) {
					return newObject[key];
				});
				var resultado = '';

				if (parametro == 'max') {
					resultado = Math.max.apply(null, arr);
				} else {
					resultado = Math.min.apply(null, arr);
				}

				for (var i = 0; i < Object.keys(JsonParseParametrosDatos.datosEstudiante).length; i++) {

					if (self.calcularPromedio(JsonParseParametrosDatos.datosEstudiante[i].notas).toPrecision(3) == resultado) {

						insertarHtmlPromediosEstudiantesMin += `<tr> 
						    <td>${ JsonParseParametrosDatos.datosEstudiante[i].cantidad }</td> 
						    <td>${ JsonParseParametrosDatos.datosEstudiante[i].detalle }</td> 
						    <td>${ JsonParseParametrosDatos.datosEstudiante[i].valorUnitario }</td> 
						    <td>${ JsonParseParametrosDatos.datosEstudiante[i].valorTotal }</td> 
							<td>${ self.calcularPromedio(JsonParseParametrosDatos.datosEstudiante[i].notas).toPrecision(3) }</td>
							</tr>`;
					}
				}
			} else {

				insertarHtmlPromediosEstudiantesMin += `<tr>
				<td colspan="3" class="text-center text-muted small"> No se encontrarón resultados </td></tr>`;
			}

			insertarHtmlPromediosEstudiantesMin += `</tbody></table>`;

			swal({
				title: `<small>Nota ${ (parametro === 'max') ? 'mayor' : 'menor' }</small> <hr>`,
				text: insertarHtmlPromediosEstudiantesMin,
				confirmButtonColor: '#333',
				confirmButtonText: 'Aceptar',
				closeOnConfirm: true,
				html: true
			}, function() {});
		}
	}

	document.addEventListener('DOMContentLoaded', function() {
		return new CONFIGURACION_POR_DEFECTO;
	});

}(jQuery, window, document));

</script>
</html>

{% endif %}